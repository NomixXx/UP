<?php
/**
 * @package     UpTaxi Portal
 * @subpackage  com_uptaxi
 * @copyright   Copyright (C) 2025 UpTaxi. All rights reserved.
 * @license     GNU General Public License version 2 or later
 */

defined('_JEXEC') or die;
?>

<div class="uptaxi-portal">
    <div class="app-container">
        <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="<?php echo JUri::root(); ?>components/com_uptaxi/assets/images/logo-uptaxi.svg" alt="UpTaxi Logo">
                    <div class="logo-text">
                        <span>–ü–æ—Ä—Ç–∞–ª</span>
                        <h2>UPTAXI</h2>
                    </div>
                </div>
                
                <div class="user-profile">
                    <div class="avatar">
                        <span id="userInitials"><?php echo strtoupper(substr($this->user->name, 0, 1)); ?></span>
                    </div>
                    <div class="user-info">
                        <span class="username"><?php echo $this->user->name; ?></span>
                        <span class="user-role"><?php echo $this->isAdmin ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'; ?></span>
                    </div>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <ul>
                        <li class="nav-item active">
                            <a href="#" onclick="showDashboard(); return false;">
                                <span class="icon">‚â°</span>
                                <b class="menu">–ú–µ–Ω—é</b>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="nav-section">
                    <ul id="dynamic-sections">
                        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                    </ul>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <?php if ($this->isAdmin): ?>
                <div class="admin-section">
                    <a href="<?php echo JRoute::_('index.php?option=com_uptaxi&view=admin'); ?>" class="admin-link">
                        <span class="icon">‚öôÔ∏è</span>
                        <b>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</b>
                    </a>
                </div>
                <?php endif; ?>
                
                <a href="<?php echo JRoute::_('index.php?option=com_users&task=user.logout&' . JSession::getFormToken() . '=1'); ?>" class="logout-btn">
                    <span class="icon">üö™</span>
                    <b>–í—ã–π—Ç–∏</b>
                </a>
            </div>
        </aside>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="main-content">
            <div class="content-header">
                <div class="breadcrumb" id="breadcrumb">
                    <span>–ì–ª–∞–≤–Ω–∞—è</span>
                </div>
            </div>

            <div class="content-area">
                <!-- –î–∞—à–±–æ—Ä–¥ -->
                <div id="dashboard" class="content-section active">
                    <div class="welcome-header">
                        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–æ—Ä—Ç–∞–ª UpTaxi</h1>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –¥–ª—è —Ä–∞–±–æ—Ç—ã –∏–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –±—ã—Å—Ç—Ä—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏</p>
                    </div>
                    <div class="dashboard-cards">
                        <div class="dashboard-card">
                            <h3>–ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏</h3>
                            <div class="quick-links" id="quick-links">
                                <!-- –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </div>
                        </div>
                        
                        <div class="dashboard-card">
                            <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</h3>
                            <div class="recent-activity" id="recent-activity">
                                <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç —Ä–∞–∑–¥–µ–ª–æ–≤ -->
                <div id="dynamic-content" class="content-section" style="display: none;">
                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Ä–∞–∑–¥–µ–ª–æ–≤ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </main>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <?php if ($this->isAdmin): ?>
    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
    <div id="addContentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</h3>
                <button onclick="closeModal('addContentModal')" class="close-btn">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="addContentForm">
                    <input type="hidden" id="contentSectionId">
                    <input type="hidden" id="contentSubsectionId">
                    <div class="form-group">
                        <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                        <input type="text" id="contentTitle" required>
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="contentDescription" rows="4" required></textarea>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                        <button type="button" onclick="closeModal('addContentModal')" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Google –¥–æ–∫—É–º–µ–Ω—Ç–∞ -->
    <div id="addDocModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ Google –¥–æ–∫—É–º–µ–Ω—Ç–∞</h3>
                <button onclick="closeModal('addDocModal')" class="close-btn">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="addDocForm">
                    <input type="hidden" id="docSectionId">
                    <input type="hidden" id="docSubsectionId">
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞</label>
                        <input type="text" id="docTitle" required>
                    </div>
                    <div class="form-group">
                        <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç</label>
                        <input type="url" id="docUrl" required placeholder="https://docs.google.com/document/...">
                    </div>
                    <button type="submit" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</button>
                </form>
            </div>
        </div>
    </div>

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ -->
    <div id="uploadFileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h3>
                <button onclick="closeModal('uploadFileModal')" class="close-btn">‚úï</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="fileSectionId">
                <input type="hidden" id="fileSubsectionId">
                <div class="upload-area">
                    <input type="file" id="fileUpload" multiple>
                    <label for="fileUpload" class="upload-label">
                        <span class="upload-icon">üìÅ</span>
                        <span>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞</span>
                    </label>
                </div>
                <button onclick="uploadFiles()" class="btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã</button>
            </div>
        </div>
    </div>
    <?php endif; ?>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ Google –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ -->
    <div id="googleDocModal" class="modal">
        <div class="modal-content" style="max-width: 95vw; max-height: 95vh; width: 95vw; height: 95vh;">
            <div class="modal-header">
                <h3 id="googleDocTitle">–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞</h3>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button onclick="openGoogleDocInNewTab()" class="btn-primary" style="padding: 8px 15px; font-size: 14px;">
                        <span class="icon">üîó</span>
                        –û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
                    </button>
                    <button onclick="closeModal('googleDocModal')" class="close-btn">‚úï</button>
                </div>
            </div>
            <div class="modal-body" style="padding: 0; height: calc(100% - 70px);">
                <iframe id="googleDocFrame" 
                        style="width: 100%; height: 100%; border: none;" 
                        src="">
                </iframe>
            </div>
        </div>
    </div>
</div>